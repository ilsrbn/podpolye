<template>
  <div class="content">
    <div class="events">
      <div v-if="!loaded" class="preload" :class="light ? 'loaded' : ''">
        <svg
          class="lamp"
          :class="light ? 'loaded' : ''"
          width="210mm"
          height="297mm"
          viewBox="0 0 210 297"
          version="1.1"
          id="svg8"
          xmlns="http://www.w3.org/2000/svg"
          xmlns:svg="http://www.w3.org/2000/svg"
          xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
          xmlns:cc="http://creativecommons.org/ns#"
          xmlns:dc="http://purl.org/dc/elements/1.1/"
        >
          <defs id="defs2">
            <filter
              style="color-interpolation-filters: sRGB"
              id="filter13164"
              x="-0.10127449"
              y="-0.091445775"
              width="1.2024816"
              height="1.1831927"
            >
              <feGaussianBlur
                stdDeviation="13.657874"
                id="feGaussianBlur13166"
              />
            </filter>
          </defs>
          <metadata id="metadata5">
            <rdf:RDF>
              <cc:Work rdf:about="">
                <dc:format>image/svg+xml</dc:format>
                <dc:type
                  rdf:resource="http://purl.org/dc/dcmitype/StillImage"
                />
              </cc:Work>
            </rdf:RDF>
          </metadata>
          <g id="layer1">
            <path
              style="fill: #000000; stroke-width: 0.894366"
              id="path28"
              d=""
            />
            <path
              style="fill: #000000; stroke-width: 0.894366"
              id="path26"
              d=""
            />
            <g
              id="g30"
              transform="matrix(0.35915174,0,0,0.35915174,-11.191241,320.81632)"
            >
              <path
                style="fill: #fef86b; stroke-width: 0.894366"
                d="m 300.85852,-193.8612 c -28.46043,-3.1538 -52.04649,-9.78174 -76.02113,-21.36283 -15.05159,-7.27076 -21.88474,-11.39602 -34.92648,-21.08557 -34.48625,-25.62206 -59.21868,-61.79349 -69.14258,-101.12175 -5.83691,-23.13157 -6.52253,-50.12302 -1.85899,-73.18474 4.26059,-21.06915 11.76938,-38.88073 27.4679,-65.15664 8.86178,-14.8327 18.02056,-30.36482 42.23771,-71.62964 2.28296,-3.89004 4.49065,-7.79686 6.20856,-10.95769 2.80699,-4.31127 3.86256,-8.31804 4.16927,-12.59072 0.19605,-2.81223 0.30341,-6.42234 0.31592,-10.74506 0.0432,-14.93064 1.36056,-23.8174 4.7769,-32.22508 5.36118,-13.19394 16.88371,-25.34964 30.31453,-31.98033 14.25158,-7.0359 11.43641,-6.84683 97.17119,-6.52604 83.70999,0.31322 77.32046,-0.12702 90.31954,6.22312 8.23371,4.02224 20.08191,15.82975 24.53121,24.44707 5.71106,11.0609 7.08347,18.04143 7.72893,39.31181 l 0.38073,12.54549 c -0.32406,6.50577 0.8121,7.40043 3.81744,13.018 l 4.74514,8.8696 c 4.60535,8.60828 13.20227,24.70687 19.10437,35.77465 5.90201,11.06779 15.30887,28.62805 20.90411,39.02281 12.31516,22.87904 15.47826,29.71531 19.97898,43.17905 6.29374,18.82792 7.62885,27.91998 7.62885,51.95308 0,18.46285 -0.2531,22.2678 -2.08199,31.30281 -11.43036,56.46548 -49.49816,103.89486 -105.20474,131.07649 -21.23216,10.36006 -42.66529,16.9623 -66.84323,20.59033 -10.87048,1.63117 -45.31548,2.40496 -55.72214,1.25178 z m 48.64806,-46.15485 c 37.10895,-4.829 71.22088,-21.32644 96.76219,-46.79677 26.84512,-26.77058 39.48207,-55.98299 39.48207,-91.26979 0,-20.55856 -3.55815,-36.19742 -12.31095,-54.10916 -4.41003,-10.7242 -11.01817,-20.74538 -15.47129,-29.10933 -5.3475,-10.06065 -14.68495,-27.54877 -20.74983,-38.8625 -17.96612,-33.51479 -24.59838,-47.03063 -26.33237,-53.66198 -1.21348,-4.6409 -1.77501,-11.11955 -2.17045,-25.04225 -0.13635,-4.80078 -0.24724,-8.39423 -0.37606,-11.14573 -0.39977,-3.49178 -0.0616,-7.53362 -1.53733,-10.56701 -0.7808,-1.57319 -1.91929,-2.78125 -3.06672,-3.73878 -3.62753,-2.9333 -14.33814,-2.72102 -75.69977,-2.72102 h -64.96465 c -5.6335,-0.37531 -7.07075,0.25635 -11.12944,3.34507 -3.70909,2.82813 -5.98446,6.60936 -6.52458,10.43833 -0.36457,2.69627 -0.50775,6.90719 -0.7114,14.83632 -0.6417,24.98425 -1.93734,28.74718 -20.94007,60.81691 -5.39226,9.10017 -14.76563,24.99753 -20.8297,35.32746 -10.40653,14.44064 -17.87288,29.96547 -25.48522,43.17372 -14.33749,24.71139 -19.56127,55.49467 -14.20694,83.72037 3.32806,17.54411 12.01128,37.23956 22.71913,51.53197 36.29836,48.44958 97.67421,72.40575 163.54338,63.83417 z"
                id="path32"
              />
              <path
                style="
                  fill: none;
                  stroke-width: 18.41723872;
                  stroke: #fef86b;
                  stroke-opacity: 1;
                  stroke-miterlimit: 4;
                  stroke-dasharray: none;
                  filter: url(#filter13164);
                "
                d="m 300.85852,-193.8612 c -28.46043,-3.1538 -52.04649,-9.78174 -76.02113,-21.36283 -15.05159,-7.27076 -21.88474,-11.39602 -34.92648,-21.08557 -34.48625,-25.62206 -59.21868,-61.79352 -69.14258,-101.12172 -5.83691,-23.1316 -6.52253,-50.1231 -1.85899,-73.1848 4.26059,-21.0691 11.76938,-38.8807 27.4679,-65.1566 8.86178,-14.8327 18.02056,-30.3648 42.23771,-71.6297 2.28296,-3.89 4.49065,-7.7968 6.20856,-10.9576 2.80699,-4.3113 3.86256,-8.3181 4.16927,-12.5908 0.19605,-2.8122 0.30341,-6.4223 0.31592,-10.745 0.0432,-14.9307 1.36056,-23.8174 4.7769,-32.2251 5.36118,-13.1939 16.88371,-25.3496 30.31453,-31.9803 14.25158,-7.0359 11.43641,-6.8469 97.17119,-6.5261 83.70999,0.3132 77.32046,-0.127 90.31954,6.2231 8.23371,4.0223 20.08191,15.8298 24.53121,24.4471 5.71106,11.0609 7.08347,18.0414 7.72893,39.3118 l 0.38073,12.5455 c -0.32406,6.5058 0.8121,7.4004 3.81744,13.018 l 4.74514,8.8696 c 4.60535,8.6083 13.20227,24.7069 19.10437,35.7747 5.90201,11.0678 15.30887,28.628 20.90411,39.0228 12.31516,22.879 15.47826,29.7153 19.97898,43.179 6.29374,18.8279 7.62885,27.92 7.62885,51.9531 0,18.4629 -0.2531,22.2678 -2.08199,31.3028 -11.43036,56.4655 -49.49816,103.89488 -105.20474,131.07651 -21.23216,10.36006 -42.66529,16.9623 -66.84323,20.59033 -10.87048,1.63117 -45.31548,2.40496 -55.72214,1.25178 z m 48.64806,-46.15485 c 37.10895,-4.829 71.22088,-21.32644 96.76219,-46.79677 26.84512,-26.7706 39.48207,-55.983 39.48207,-91.2698 0,-20.5586 -3.55815,-36.1974 -12.31095,-54.1092 -4.41003,-10.7242 -11.01817,-20.7453 -15.47129,-29.1093 -5.3475,-10.0606 -14.68495,-27.5488 -20.74983,-38.8625 -17.96612,-33.5148 -24.59838,-47.0306 -26.33237,-53.662 -1.21348,-4.6409 -1.77501,-11.1195 -2.17045,-25.0422 -0.13635,-4.8008 -0.24724,-8.3942 -0.37606,-11.1457 -0.39977,-3.4918 -0.0616,-7.5337 -1.53733,-10.5671 -0.7808,-1.5731 -1.91929,-2.7812 -3.06672,-3.7387 -3.62753,-2.9333 -14.33814,-2.7211 -75.69977,-2.7211 h -64.96465 c -5.6335,-0.3753 -7.07075,0.2564 -11.12944,3.3451 -3.70909,2.8281 -5.98446,6.6094 -6.52458,10.4383 -0.36457,2.6963 -0.50775,6.9072 -0.7114,14.8364 -0.6417,24.9842 -1.93734,28.7471 -20.94007,60.8169 -5.39226,9.1001 -14.76563,24.9975 -20.8297,35.3274 -10.40653,14.4407 -17.87288,29.9655 -25.48522,43.1738 -14.33749,24.7113 -19.56127,55.4946 -14.20694,83.7203 3.32806,17.5441 12.01128,37.2396 22.71913,51.532 36.29836,48.44958 97.67421,72.40575 163.54338,63.83417 z"
                id="path32-5"
              />
            </g>
          </g>
        </svg>
      </div>
      <div class="page" :class="loaded ? 'show' : ''">
        <h1>Что Вас ждёт в ближайшие 2 недели:</h1>
        <hr />
        <div v-swiper:mySwiper="swiperOption">
          <div class="swiper-wrapper">
            <div
              v-for="(event, index) in items"
              :key="index"
              class="swiper-slide"
            >
              <div class="event">
                <img
                  class="event__image"
                  v-if="event.attachments != undefined"
                  :src="imageURL + event.attachments[0].fileId"
                  alt=""
                />
                <img
                  v-else
                  class="event__image"
                  :src="require('~/assets/images/gallery/1-test.jpg')"
                />
                <div class="text">
                  <h1 class="title">{{ event.summary }}</h1>
                  <p class="description">{{ event.description }}</p>
                  <div class="time">
                    <span class="el">
                      <img :src="require('~/assets/images/time.png')" alt="" />
                    </span>
                    <span class="el">
                      <small class="date">
                        {{ formatDate(event.start.dateTime) }}
                      </small>
                      <small>{{ event.start.dateTime.slice(11, 16) }}</small>
                    </span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <hr>
    <Rules />
  </div>
</template>

<script>
export default {
  layout: "main",
  data: () => ({
    loaded: false,
    light: false,
    items: [],
    swiperOption: {
      autoplay: true,
      loop: true,
      slidesPerView: 1,
      centeredSlides: true,
      spaceBetween: 30,
      keyboard: true,
      speed: 1000,
      breakpoints: {
        768: {
          slidesPerView: 3
        }
      }
    },
    imageURL: "https://drive.google.com/uc?id=",
  }),

  async mounted() {
    let startDate = new Date().toISOString();
    let endDate = new Date(Date.now() + 1209600000).toISOString();

    let items = await this.$axios.$get(
      `https://www.googleapis.com/calendar/v3/calendars/65k2m2ep03mnqkuthtdkjs6h0g%40group.calendar.google.com/events?orderBy=startTime&timeMin=${startDate}&timeMax=${endDate}&singleEvents=true&key=AIzaSyC-OIomtul6ENmZLoZX0uMiJXD7Kwt0w74`
    );
    this.items = items.items;
    setTimeout(() => {
      this.mySwiper.slideTo(3, 1000, false);
    }, 1000);
    this.light = true;
    setTimeout(() => {
      this.loaded = true;
    }, 2000);
  },

  methods: {
    formatDate(date) {
      let newDate = Date.parse(date);
      return new Date(newDate).toLocaleDateString("ru-RU", {
        weekday: "short",
        month: "short",
        day: "numeric",
      });
    },
  },
};
</script>

<style lang="scss" scoped>
    hr {
      margin: 4.25rem 0;
    }
.content {
  position: relative;
  width: 100%;
  max-height: unset;
  padding: 1rem 2rem;
  .preload {
    position: absolute;
    z-index: 9999;
    top: -5rem;
    left: 0;
    width: 100%;
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    background: rgba($color: #0d0d0d, $alpha: 1);
    padding: 0;
    margin: 0;

    opacity: 1;

    transition: opacity 200ms 1s ease-in;
    .lamp {
      height: 100px;
      #g30 {
        path {
          fill: #d9d5cc !important;
          stroke: rgba($color: #fef86b, $alpha: 0) !important;

          transition-property: fill stroke;
          transition-duration: 100ms;
          transition-timing-function: ease-in;
        }
      }
      &.loaded {
        #g30 {
          path {
            fill: #fef86b !important;
            stroke: rgba($color: #fef86b, $alpha: 1) !important;
          }
        }
      }
    }
    &.loaded {
      opacity: 0;
    }
  }
  .events {
    align-self: flex-start;
    width: 100%;
    padding: 1rem 0 0;
    overflow-x: hidden;

    h1 {
      color: #d9d5cc;
      font-size: 5rem;
      margin: 0;
      line-height: 5rem;
    }

    .swiper-slide {
      border: 6px dashed #d9d5cc;
      outline: none;

      text-decoration: none;
      opacity: 0.5;
      transition: opacity 150ms ease-in;

      .event {
        width: 100%;
        height: 100%;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        padding: 0;

        .event__image {
          max-width: 100%;
          outline: 6px solid #d9d5cc;

          transition-property: border-right;
          transition-duration: 80ms;
          transition-timing-function: ease-in;
        }

        .text {
          display: flex;
          flex-direction: column;
          width: 100%;

          h1 {
            color: #d9d5cc;
            font-size: 3rem;
            font-family: "Amatic SC", cursive;
            font-weight: 600;
            letter-spacing: 2px;
            text-align: center;
            margin-bottom: 0;
            padding: 1rem 0;
          }
          .description {
            border-top: 1px solid #d9d5cc;
            border-bottom: 1px solid #d9d5cc;
          }
          .time {
            display: flex;
            flex-direction: row;
            width: 100%;
            justify-content: space-around;
            align-items: center;
            padding: 1rem;
            .el {
              display: flex;
              justify-content: center;
              align-items: center;
              flex-direction: column;
              img {
                max-height: 5rem;
              }
            }

            small {
              color: #d9d5cc;
              width: max-content;
              word-wrap: normal;
              text-transform: uppercase;
              opacity: 0.7;
              font-size: 2.18rem;
              font-family: "Merriweather", serif;
              font-style: italic;
            }
          }
        }
      }
      &.swiper-slide-active {
        opacity: 1;
      }
    }
  }
}
</style>